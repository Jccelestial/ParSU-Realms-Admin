<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParSU Realms - Admin Dashboard</title>
    <link rel="icon" type="image/png" href="/image/Paaasrrsu'.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <img src="/image/Paaasrrsu'.png" alt="ParSU Realms" class="logo-image-full">
                <h3>Admin Dashboard</h3>
            </div>
            <nav class="nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                    </svg>
                    Users
                </a>
                <a href="#" class="nav-item" data-page="quests">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    Quests
                </a>
                <a href="#" class="nav-item" data-page="analytics">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    Analytics
                </a>
                <a href="#" class="nav-item" data-page="logs">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    Activity Logs
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout"> Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle Menu">
                    <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle Dark Mode">
                        <svg class="icon sun-icon" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                        </svg>
                        <svg class="icon moon-icon" fill="currentColor" viewBox="0 0 24 24" style="display: none;">
                            <path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Dashboard Page -->
            <section id="dashboard-page" class="page active">
                <div class="stats-grid">
                    <div class="stat-card stat-users">
                        <div class="stat-icon">
                            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-users">-</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="stat-card stat-quests">
                        <div class="stat-icon">
                            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 id="completed-quests">-</h3>
                            <p>Quests Completed</p>
                        </div>
                    </div>
                    <div class="stat-card stat-active">
                        <div class="stat-icon">
                            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 id="active-users">-</h3>
                            <p>Active Players</p>
                        </div>
                    </div>
                    <div class="stat-card stat-avg">
                        <div class="stat-icon">
                            <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <h3 id="avg-playtime">-</h3>
                            <p>Avg. Quests/Player</p>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Quest Completion Rate</h3>
                        <div style="height: 220px; position: relative; pointer-events: none;">
                            <canvas id="questChart" style="pointer-events: auto;"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>User Registrations (Last 7 Days)</h3>
                        <div style="height: 220px; position: relative; pointer-events: none;">
                            <canvas id="userChart" style="pointer-events: auto;"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Delete Confirmation Modal -->
            <div id="delete-modal-overlay" class="modal-overlay" style="display:none;">
                <div class="modal">
                    <h3>Confirm Delete</h3>
                    <p>Are you sure you want to delete this user? This action cannot be undone.</p>
                    <div class="modal-actions">
                        <button class="modal-btn confirm" id="confirm-delete-btn">Delete</button>
                        <button class="modal-btn cancel" id="cancel-delete-btn">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <section id="users-page" class="page">
                <div class="page-header">
                    <input type="text" id="user-search" placeholder=" Search users..." class="search-input">
                    <button class="btn-primary" id="refresh-users">Refresh</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Registered</th>
                                <th>Last Login</th>
                                <th>Quests</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <tr>
                                <td colspan="7" class="loading">Loading users...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quests Page -->
            <section id="quests-page" class="page">
                <div class="quest-stats">
                    <h3>Quest Completion Statistics</h3>
                    <div id="quest-stats-container" class="quest-grid">
                        <!-- Quest stats will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Analytics Page -->
            <section id="analytics-page" class="page">
                <div class="analytics-container">
                    <h3>Usage Analytics</h3>
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Peak Hours</h4>
                            <div style="height: 200px; position: relative;">
                                <canvas id="peakHoursChart"></canvas>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>Most Popular Quests</h4>
                            <div id="popular-quests" class="fade-in"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Logs Page -->
            <section id="logs-page" class="page">
                <div class="page-header">
                    <select id="log-filter" class="filter-select">
                        <option value="all">All Activities</option>
                        <option value="logins">Logins</option>
                        <option value="quest">Quest Events</option>
                    </select>
                    <button class="btn-primary" id="refresh-logs"> Refresh</button>
                </div>
                <div class="logs-container" id="logs-container">
                    <div class="log-entry">
                        <span class="log-time">Loading logs...</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logout-modal-overlay" class="modal-overlay" style="display:none;">
        <div class="modal">
            <h3>Confirm Logout</h3>
            <p>Are you sure you want to logout?</p>
            <div class="modal-actions">
                <button class="modal-btn confirm" id="confirm-logout-btn">Logout</button>
                <button class="modal-btn cancel" id="cancel-logout-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
    <script>
    // Logout modal logic
    const logoutModal = document.getElementById('logout-modal-overlay');
    const confirmLogoutBtn = document.getElementById('confirm-logout-btn');
    const cancelLogoutBtn = document.getElementById('cancel-logout-btn');
    const logoutButton = document.querySelector('.btn-logout');

    if (logoutButton) {
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            logoutModal.style.display = 'flex';
            // focus confirm for accessibility
            setTimeout(() => confirmLogoutBtn?.focus(), 50);
        });
    }

    if (cancelLogoutBtn) {
        cancelLogoutBtn.addEventListener('click', () => {
            logoutModal.style.display = 'none';
            logoutButton?.focus();
        });
    }

    if (confirmLogoutBtn) {
        confirmLogoutBtn.addEventListener('click', () => {
            // Hide modal immediately
            logoutModal.style.display = 'none';
            // Call global logout if available
            if (typeof window.logout === 'function') {
                try { window.logout(); } catch (e) { console.error(e); window.location.href = 'login.html'; }
            } else if (typeof logout === 'function') {
                try { logout(); } catch (e) { console.error(e); window.location.href = 'login.html'; }
            } else {
                // fallback
                try { localStorage.removeItem('adminLoggedIn'); localStorage.removeItem('adminLoginTime'); localStorage.removeItem('adminEmail'); } catch(e){}
                window.location.href = 'login.html';
            }
        });
    }
    </script>
</body>
</html>
